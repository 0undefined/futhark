-- Source code:

--   def main [m][n] (xs: [m][n]i64) (is: [m]i64) (is1: [n]i64) : [m][n]i64 =
--   map (\i ->
--     map (\j ->
--       #[unsafe] xs[is[is1[i]],is1[is[j]]]
--       ) (iota n)
--     ) (iota m)

-- IR:

types {

}



entry("main",
      {xs: [][]i64,
       is: []i64,
       is1: []i64},
      {[][]i64})
  entry_main (m_5435 : i64,
              n_5436 : i64,
              xs_5437 : [m_5435][n_5436]i64,
              is_5438 : [m_5435]i64,
              is1_5439 : [n_5436]i64)
  : {[m_5435][n_5436]i64#([2, 3, 4], [0])} = {
  let {segmap_group_size_5634 : i64} =
    get_size(segmap_group_size_5626, group_size)
  let {segmap_usable_groups_5635 : i64} =
    sdiv_up64(m_5435, segmap_group_size_5634)
  let {tmp_r_5636 : [m_5435]i64} =
    segmap(thread; ; groups=segmap_usable_groups_5635; groupsize=segmap_group_size_5634)
    (gtid_5637 < m_5435) (~phys_tid_5638) : {i64} {
      let {is1_elem_5639 : i64} =
        is1_5439[gtid_5637]
      let {tmp_5640 : i64} =
        is_5438[is1_elem_5639]
      return {returns tmp_5640}
    }
  let {nest_size_5646 : i64} =
    mul_nw64(m_5435, n_5436)
  let {segmap_group_size_5647 : i64} =
    get_size(segmap_group_size_5601, group_size)
  let {segmap_usable_groups_5648 : i64} =
    sdiv_up64(nest_size_5646, segmap_group_size_5647)
  let {defunc_0_map_res_5649 : [m_5435][n_5436]i64} =
    segmap(thread; ; groups=segmap_usable_groups_5648; groupsize=segmap_group_size_5647)
    (gtid_5650 < m_5435, gtid_5651 < n_5436) (~phys_tid_5652) : {i64} {
      let {tmp_5653 : i64} =
        tmp_r_5636[gtid_5650]
      let {is_elem_5654 : i64} =
        is_5438[gtid_5651]
      let {tmp_5655 : i64} =
        is1_5439[is_elem_5654]
      let {lifted_lambda_res_5656 : i64} =
        xs_5437[tmp_5653, tmp_5655]
      return {returns lifted_lambda_res_5656}
    }
  in {defunc_0_map_res_5649}
}

-- === Expected output of analysis:
-- (segmap) defunc_0_map_res_5649 : {
--     (arr) xs_5437 : {
--         (idx) lifted_lambda_res_5656 :
--             0 : dependencies = tmp_5653 -> {gtid_5650 0 tid}
--             1 : dependencies = tmp_5655 -> {gtid_5651 1 tid}
--     }
-- }
